generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = env("DATABASE_PROVIDER")
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
}

enum SubmissionType {
  BOOKING
  QUESTION
}

enum SubmissionStatus {
  NEW
  IN_PROGRESS
  DONE
}

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  password  String
  role      Role     @default(ADMIN)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ServiceCategory {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  description String?
  order       Int        @default(0)
  services    Service[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Service {
  id               String            @id @default(cuid())
  categoryId       String
  category         ServiceCategory   @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  title            String
  slug             String            @unique
  excerpt          String?
  description      String?           @db.Text
  preparation      String?           @db.Text
  contraindications String?          @db.Text
  aftercare        String?           @db.Text
  duration         String?
  imageId          String?
  image            Media?            @relation("ServiceImage", fields: [imageId], references: [id], onDelete: SetNull)
  isFeatured       Boolean           @default(false)
  order            Int               @default(0)
  prices           Price[]
  portfolioItems   PortfolioItem[]
  reviews          Review[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
}

model Price {
  id        String   @id @default(cuid())
  serviceId String
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  name      String
  amount    Int?
  currency  String   @default("RUB")
  description String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Media {
  id              String           @id @default(cuid())
  filename        String
  url             String
  alt             String?
  mimeType        String
  size            Int?
  width           Int?
  height          Int?
  serviceImage    Service?         @relation("ServiceImage")
  portfolioCover  PortfolioItem?   @relation("PortfolioCover")
  postCover       Post?            @relation("PostCover")
  reviewAvatar    Review?          @relation("ReviewAvatar")
  createdAt       DateTime         @default(now())
}

model PortfolioItem {
  id            String    @id @default(cuid())
  title         String
  slug          String    @unique
  description   String?   @db.Text
  coverImageId  String?
  coverImage    Media?    @relation("PortfolioCover", fields: [coverImageId], references: [id], onDelete: SetNull)
  serviceId     String?
  service       Service?  @relation(fields: [serviceId], references: [id], onDelete: SetNull)
  tags          String[]
  isFeatured    Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Review {
  id          String   @id @default(cuid())
  author      String
  rating      Int      @default(5)
  content     String   @db.Text
  source      String?
  serviceId   String?
  service     Service? @relation(fields: [serviceId], references: [id], onDelete: SetNull)
  avatarId    String?
  avatar      Media?   @relation("ReviewAvatar", fields: [avatarId], references: [id], onDelete: SetNull)
  isFeatured  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Promo {
  id             String   @id @default(cuid())
  title          String
  slug           String   @unique
  excerpt        String?
  body           String?  @db.Text
  startsAt       DateTime?
  endsAt         DateTime?
  isActive       Boolean  @default(true)
  seoTitle       String?
  seoDescription String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Post {
  id             String   @id @default(cuid())
  title          String
  slug           String   @unique
  excerpt        String?
  content        String?  @db.Text
  coverImageId   String?
  coverImage     Media?   @relation("PostCover", fields: [coverImageId], references: [id], onDelete: SetNull)
  seoTitle       String?
  seoDescription String?
  publishedAt    DateTime?
  isPublished    Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Page {
  id             String   @id @default(cuid())
  title          String
  slug           String   @unique
  excerpt        String?
  content        Json
  seoTitle       String?
  seoDescription String?
  published      Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Submission {
  id          String           @id @default(cuid())
  name        String
  contact     String
  service     String?
  message     String?          @db.Text
  type        SubmissionType   @default(BOOKING)
  status      SubmissionStatus @default(NEW)
  meta        Json?
  createdAt   DateTime         @default(now())
}

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
